# Концепция H-MEM

H-MEM (Hierarchical Memory) — 4-уровневая архитектура памяти с LLM-консолидацией.

## Проблема

Традиционная AI-память плоская:
- Буферная память: Ограниченная история
- Entity memory: Только факты, без контекста
- Нет долгосрочного обучения

## Решение: H-MEM

4-уровневая иерархия, имитирующая человеческую память:

```
┌─────────────────────────────────────────────────────────────────┐
│                    H-MEM 4 уровня                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Уровень 3: Домен     │ Мета-знания, профиль пользователя       │
│  └── "Технический пользователь, предпочитает Python, работает в ML"│
│           ↑ консолидация                                        │
│                                                                  │
│  Уровень 2: Категория │ Суммированные концепции                 │
│  └── "Предпочтения пользователя: тёмная тема, детальные объяснения"│
│           ↑ консолидация                                        │
│                                                                  │
│  Уровень 1: Трейс     │ Группировки сущность-факт               │
│  └── {user: "Алекс", skills: ["Python", "ML"]}                  │
│           ↑ консолидация                                        │
│                                                                  │
│  Уровень 0: Эпизод    │ Сырые сообщения разговора               │
│  └── "User: Я программирую на Python уже 5 лет"                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Как работает консолидация

1. **Накопление эпизодов**: Сырые сообщения сохраняются
2. **Триггер порога**: После N эпизодов начинается консолидация
3. **LLM-суммирование**: LLM извлекает ключевую информацию
4. **Создание трейсов**: Группировка по теме/сущности
5. **Формирование категорий**: Концепции высокого уровня
6. **Построение домена**: Мета-знания о пользователе

## Преимущества

| Функция | Преимущество |
|---------|--------------|
| **Долгосрочная память** | Помнит между сессиями |
| **Эффективное хранение** | Сжатие на высших уровнях |
| **Контекстно-осознанная** | Адаптируется к пользователю |
| **Персистентная** | Сохраняется на диск |

## Конфигурация

```python
from rlm_toolkit.memory import HierarchicalMemory, HMEMConfig

config = HMEMConfig(
    episode_limit=100,
    trace_limit=50,
    category_limit=20,
    domain_limit=10,
    consolidation_enabled=True,
    consolidation_threshold=25
)

memory = HierarchicalMemory(
    config=config,
    persist_directory="./memory"
)
```

## Связанное

- [Туториал: H-MEM](../tutorials/07-hmem.md)
- [Туториал: Системы памяти](../tutorials/05-memory.md)
